// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Generator untuk Prisma Client Python
generator client {
  provider = "prisma-client-py"
  previewFeatures = []
}

// Definisi Koneksi Database
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ==================== EXISTING MODEL ====================
model DetectionRecord {
  id        String   @id @default(cuid())
  image_path String
  disease_type String
  confidence Float
  latitude  Float?
  longitude Float?
  timestamp     DateTime @default(now())
  createdAt DateTime @default(now())
}

// ==================== SWARM MODELS ====================

// Definisi Model (menggunakan String untuk status)

model Drone {
  id                String   @id @default(cuid())
  name              String
  status            String   @default("IDLE")
  battery_level     Float    @default(100.0) // DIUBAH: tipe data dari Int ke Float
  pesticide_level   Float?   @default(100.0) // DITAMBAHKAN: kolom baru untuk level pestisida
  current_latitude  Float?
  current_longitude Float?

  assignedZone      Zone?    @relation(fields: [assignedZoneId], references: [id])
  assignedZoneId    String?  @unique

  tasks             Task[]

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Zone {
  id               String   @id @default(cuid())
  name             String
  status           String   @default("UNASSIGNED")
  coordinates      String

  drone            Drone?

  tasks            Task[]

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Task {
  id           String    @id @default(cuid())
  status       String    @default("PENDING")
  created_at   DateTime  @default(now())
  started_at   DateTime?
  completed_at DateTime?

  droneId      String
  zoneId       String

  drone        Drone     @relation(fields: [droneId], references: [id])
  zone         Zone      @relation(fields: [zoneId], references: [id])
}

// ==================== IOT MODELS (PHASE 6) ====================

model SensorData {
  id        Int      @id @default(autoincrement())
  sensorId  String   // misal: "TEMP_01", "SOIL_01"
  type      String   // "temperature", "humidity", "soil_moisture"
  value     Float
  unit      String   // "C", "%", "kPa"
  timestamp DateTime @default(now())
}
